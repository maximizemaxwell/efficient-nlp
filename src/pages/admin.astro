---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Admin - AI Journal Club">
  <main class="container">
    <header class="admin-header">
      <h1>Admin Panel</h1>
      <p>Manage lecture materials and video links</p>
    </header>

    <section class="upload-section">
      <div class="upload-card">
        <h2>PDF File Upload</h2>
        <p class="instruction">Upload PDF lecture materials for each week.</p>
        
        <div class="upload-form">
          <div class="form-group">
            <label for="week-select">Select Week:</label>
            <select id="week-select" class="form-control">
              <option value="0">Week 0 - OT</option>
              <option value="1">Week 1 - Efficient Methods for NLP</option>
              <option value="2">Week 2 - Efficient Inference for LLMs</option>
              <option value="3">Week 3 - DRPruning</option>
              <option value="4">Week 4 - QPruner</option>
              <option value="5">Week 5 - L4Q</option>
              <option value="6">Week 6 - ResLoRA</option>
              <option value="7">Week 7 - MeMoTune</option>
              <option value="8">Week 8 - DiffSkip</option>
              <option value="9">Week 9 - Constrained Decoding</option>
              <option value="10">Week 10 - DB-LLM</option>
              <option value="11">Week 11 - PruneVid</option>
              <option value="12">Week 12 - Continual Pre-training</option>
              <option value="13">Week 13 - Efficient LLMs Survey</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="pdf-upload">PDF File:</label>
            <input type="file" id="pdf-upload" accept=".pdf" class="form-control">
          </div>
          
          <button id="upload-btn" class="btn-primary">Upload PDF</button>
        </div>
      </div>

      <div class="upload-card">
        <h2>Video Link Management</h2>
        <p class="instruction">Set video links for each week.</p>
        
        <div class="upload-form">
          <div class="form-group">
            <label for="video-week-select">Select Week:</label>
            <select id="video-week-select" class="form-control">
              <option value="0">Week 0 - OT</option>
              <option value="1">Week 1 - Efficient Methods for NLP</option>
              <option value="2">Week 2 - Efficient Inference for LLMs</option>
              <option value="3">Week 3 - DRPruning</option>
              <option value="4">Week 4 - QPruner</option>
              <option value="5">Week 5 - L4Q</option>
              <option value="6">Week 6 - ResLoRA</option>
              <option value="7">Week 7 - MeMoTune</option>
              <option value="8">Week 8 - DiffSkip</option>
              <option value="9">Week 9 - Constrained Decoding</option>
              <option value="10">Week 10 - DB-LLM</option>
              <option value="11">Week 11 - PruneVid</option>
              <option value="12">Week 12 - Continual Pre-training</option>
              <option value="13">Week 13 - Efficient LLMs Survey</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="video-url">Video URL:</label>
            <input type="url" id="video-url" placeholder="https://youtube.com/watch?v=..." class="form-control">
          </div>
          
          <button id="video-btn" class="btn-primary">Save Link</button>
        </div>
      </div>
    </section>

    <section class="status-section">
      <h2>Current Status</h2>
      <div class="status-grid" id="status-grid">
        <!-- Dynamically generated by JavaScript -->
      </div>
    </section>

    <div class="info-box">
      <h3>ðŸ“Œ Usage Guide</h3>
      <ul>
        <li>PDF files are saved in public/pdfs/ folder as weekN.pdf format.</li>
        <li>Video links are stored in browser local storage. Separate management needed for production.</li>
        <li>Download links will appear on the main page after file upload.</li>
      </ul>
    </div>
  </main>
</Layout>

<style>
  .admin-header {
    text-align: center;
    padding: 3rem 0;
    border-bottom: 1px solid #374151;
  }

  .admin-header h1 {
    font-size: 2.5rem;
    font-weight: 700;
    color: #f9fafb;
    margin-bottom: 1rem;
  }

  .admin-header p {
    font-size: 1.2rem;
    color: #9ca3af;
  }

  .upload-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 2rem;
    margin: 3rem 0;
  }

  .upload-card {
    background: rgba(17, 24, 39, 0.6);
    border: 1px solid #374151;
    border-radius: 12px;
    padding: 2rem;
    backdrop-filter: blur(10px);
  }

  .upload-card h2 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #f9fafb;
    margin-bottom: 0.5rem;
  }

  .instruction {
    color: #9ca3af;
    margin-bottom: 2rem;
    font-size: 0.95rem;
  }

  .upload-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group label {
    font-weight: 500;
    color: #e5e7eb;
    font-size: 0.9rem;
  }

  .form-control {
    padding: 0.75rem;
    border: 1px solid #4b5563;
    border-radius: 6px;
    background: rgba(31, 41, 55, 0.8);
    color: #f9fafb;
    font-size: 0.95rem;
    transition: border-color 0.2s ease;
  }

  .form-control:focus {
    outline: none;
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
  }

  .btn-primary {
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, #1e40af 0%, #7c3aed 100%);
    color: white;
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.95rem;
  }

  .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }

  .btn-primary:active {
    transform: translateY(0);
  }

  .status-section {
    margin: 3rem 0;
  }

  .status-section h2 {
    font-size: 1.8rem;
    font-weight: 600;
    color: #f9fafb;
    margin-bottom: 1.5rem;
  }

  .status-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .status-item {
    background: rgba(31, 41, 55, 0.6);
    border: 1px solid #4b5563;
    border-radius: 8px;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .status-item.has-pdf {
    border-color: #10b981;
  }

  .status-item.has-video {
    background: rgba(16, 185, 129, 0.1);
  }

  .week-label {
    font-weight: 500;
    color: #e5e7eb;
  }

  .status-indicators {
    display: flex;
    gap: 0.5rem;
  }

  .indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #6b7280;
  }

  .indicator.active {
    background: #10b981;
  }

  .info-box {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid #3b82f6;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 3rem 0;
  }

  .info-box h3 {
    font-size: 1.2rem;
    font-weight: 600;
    color: #93c5fd;
    margin-bottom: 1rem;
  }

  .info-box ul {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .info-box li {
    color: #d1d5db;
    margin-bottom: 0.5rem;
    padding-left: 1.5rem;
    position: relative;
    font-size: 0.9rem;
  }

  .info-box li::before {
    content: "â€¢";
    position: absolute;
    left: 0;
    color: #60a5fa;
  }

  @media (max-width: 768px) {
    .upload-section {
      grid-template-columns: 1fr;
    }

    .admin-header h1 {
      font-size: 2rem;
    }

    .upload-card {
      padding: 1.5rem;
    }
  }
</style>

<script>
  // Status update function
  function updateStatus() {
    const statusGrid = document.getElementById('status-grid');
    if (!statusGrid) return;

    const weeks = [
      { week: 0, title: 'OT' },
      { week: 1, title: 'Efficient Methods for NLP' },
      { week: 2, title: 'Efficient Inference for LLMs' },
      { week: 3, title: 'DRPruning' },
      { week: 4, title: 'QPruner' },
      { week: 5, title: 'L4Q' },
      { week: 6, title: 'ResLoRA' },
      { week: 7, title: 'MeMoTune' },
      { week: 8, title: 'DiffSkip' },
      { week: 9, title: 'Constrained Decoding' },
      { week: 10, title: 'DB-LLM' },
      { week: 11, title: 'PruneVid' },
      { week: 12, title: 'Continual Pre-training' },
      { week: 13, title: 'Efficient LLMs Survey' }
    ];

    statusGrid.innerHTML = weeks.map(item => {
      const hasVideo = localStorage.getItem(`video_week_${item.week}`) !== null;
      
      return `
        <div class="status-item ${hasVideo ? 'has-video' : ''}">
          <div class="week-label">Week ${item.week}</div>
          <div class="status-indicators">
            <div class="indicator" title="PDF"></div>
            <div class="indicator ${hasVideo ? 'active' : ''}" title="Video"></div>
          </div>
        </div>
      `;
    }).join('');
  }

  // PDF upload handling
  document.getElementById('upload-btn')?.addEventListener('click', function() {
    const weekSelect = document.getElementById('week-select') as HTMLSelectElement;
    const fileInput = document.getElementById('pdf-upload') as HTMLInputElement;
    
    if (!weekSelect || !fileInput) return;
    
    const week = weekSelect.value;
    const file = fileInput.files?.[0];
    
    if (!file) {
      alert('Please select a PDF file.');
      return;
    }
    
    if (file.type !== 'application/pdf') {
      alert('Only PDF files can be uploaded.');
      return;
    }
    
    // In actual implementation, upload file to server
    alert(`Week ${week} PDF file has been uploaded.\nIn production, it will be saved as public/pdfs/week${week}.pdf`);
    
    fileInput.value = '';
    updateStatus();
  });

  // Save video link
  document.getElementById('video-btn')?.addEventListener('click', function() {
    const weekSelect = document.getElementById('video-week-select') as HTMLSelectElement;
    const urlInput = document.getElementById('video-url') as HTMLInputElement;
    
    if (!weekSelect || !urlInput) return;
    
    const week = weekSelect.value;
    const url = urlInput.value.trim();
    
    if (!url) {
      alert('Please enter video URL.');
      return;
    }
    
    try {
      new URL(url);
    } catch {
      alert('Invalid URL format.');
      return;
    }
    
    localStorage.setItem(`video_week_${week}`, url);
    alert(`Week ${week} video link has been saved.`);
    
    urlInput.value = '';
    updateStatus();
  });

  // Update status on page load
  document.addEventListener('DOMContentLoaded', updateStatus);
</script>